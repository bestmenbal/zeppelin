<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sktelecom.cep.dao.ResourceInfoDao">

    <resultMap id="ResourceInfoMap" type="com.sktelecom.cep.vo.ResourceInfo">
        <!-- 실제 DB컬럼과 매핑 -->
        <result property="resourceId" column="resource_id" />
        <result property="resourceName" column="resource_name" />
        <result property="resourceType" column="resource_type" />
        <result property="resourceDesc" column="resource_desc" />
        <result property="createId" column="create_id" />
        <result property="updateId" column="update_id" />
        <result property="createIdName" column="create_id_name" />
        <result property="updateIdName" column="update_id_name" />
        <result property="createDate" column="create_date" />
        <result property="updateDate" column="update_date" />
        <collection property="resourceProperty" column="resource_id" select="getListByResourceId" />
    </resultMap>
    

    <insert id="create" parameterType="com.sktelecom.cep.vo.ResourceInfo">
        INSERT INTO resource_info(resource_id, resource_name, resource_type, resource_desc, create_id, create_id_name, create_date, update_id, update_id_name, update_date)
        VALUES (#{resourceId}, #{resourceName}, #{resourceType}, #{resourceDesc}, #{createId}, #{createIdName}, now(), #{updateId}, #{updateIdName}, now())
    </insert>

    <update id="update" parameterType="com.sktelecom.cep.vo.ResourceInfo">
        UPDATE resource_info
        SET 
		    resource_name = #{resourceName}
            ,resource_type = #{resourceType}
            ,resource_desc = #{resourceDesc}
            ,update_id = #{updateId}
            ,update_id_name = #{updateIdName}
            ,update_date = now()
        WHERE resource_id = #{resourceId}
    </update>

    <delete id="delete" parameterType="com.sktelecom.cep.vo.ResourceInfo">
        DELETE FROM resource_info
        WHERE resource_id = #{resourceId}
    </delete>

    <select id="getInfo" parameterType="com.sktelecom.cep.vo.ResourceInfo" resultMap="ResourceInfoMap">
        SELECT resource_id, resource_name, resource_type, resource_desc, create_id, create_id_name, update_id, update_id_name, create_date, update_date
        FROM resource_info
        WHERE resource_id = #{resourceId}
    </select>
    
    <select id="getResourceInfoByResourceName" parameterType="com.sktelecom.cep.vo.ResourceInfo" resultMap="ResourceInfoMap">
        SELECT resource_id, resource_name, resource_type, resource_desc, create_id, create_id_name, update_id, update_id_name, create_date, update_date
        FROM resource_info
        WHERE resource_name = #{resourceName}
          AND resource_type = #{resourceType}
    </select>    

    <select id="getList" resultMap="ResourceInfoMap" parameterType="com.sktelecom.cep.vo.ResourceInfo">
        SELECT resource_id, resource_name, resource_type, resource_desc, create_id, create_id_name, update_id, update_id_name, create_date, update_date
        FROM resource_info
        WHERE resource_type = #{resourceType}
        ORDER BY resource_id
        LIMIT #{beginRowNum}, #{rowsPerPage}
    </select>

    <select id="getListCount" resultType="long" parameterType="com.sktelecom.cep.vo.ResourceInfo">
        SELECT count(resource_id)
        FROM resource_info
        WHERE resource_type = #{resourceType}
    </select>
    
    
    <resultMap id="ResourcePropertyMap" type="com.sktelecom.cep.vo.ResourceProperty">
        <!-- 실제 DB컬럼과 매핑 -->
        <result property="resourceId" column="resource_id" />
        <result property="propertyKey" column="property_key" />
        <result property="propertyValue" column="property_value" />
    </resultMap>
    <select id="getListByResourceId" resultMap="ResourcePropertyMap" parameterType="com.sktelecom.cep.vo.ResourceProperty">
        SELECT resource_id, property_key, property_value
        FROM resource_property
        WHERE resource_id = #{resourceId}
    </select>



</mapper>
